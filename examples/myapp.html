<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <title>SlickGrid example 3: Editing</title>
  <link rel="stylesheet" href="../slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="../css/smoothness/jquery-ui-1.8.16.custom.css" type="text/css"/>
  <link rel="stylesheet" href="examples.css" type="text/css"/>
  <style>
    .cell-title {
      font-weight: bold;
    }

    .cell-effort-driven {
      text-align: center;
    }
  </style>
</head>
<body>
<div id="container" class="current">
  <div id="assumption">
    <div id="myGrid" style="height:350px;"></div>
  </div>                     
  <div id="pl">              
     <div id="plGrid" style="height:280px;"></div>
  </div>                            
  <div id="bs">                     
     <div id="bsGrid" style="height:250px;"></div>
  </div>
  <div id="cf">                     
     <div id="cfGrid" style="height:250px;"></div>
  </div>
  
  <!-- <div class="options-panel">
    <input type="button" name="add_row" value="add_row" id="add_row">
    <input type="button" name="remove_row" value="remove_row" id="remove_row">
  </div> -->
</div>

<script src="../lib/firebugx.js"></script>
<script src="../lib/jquery-1.7.min.js"></script>
<script src="../lib/jquery-ui-1.8.16.custom.min.js"></script>
<script src="../lib/jquery.event.drag-2.0.min.js"></script>
<script src="../slick.core.js"></script>
<script src="../plugins/slick.cellrangedecorator.js"></script>
<script src="../plugins/slick.cellrangeselector.js"></script>
<script src="../plugins/slick.cellselectionmodel.js"></script>
<script src="../slick.formatters.js"></script>
<script src="../slick.editors.js"></script>
<script src="../slick.grid.js"></script>

<script>
  function requiredFieldValidator(value) {
    if (value == null || value == undefined || !value.length) {
      return {valid: false, msg: "This is a required field"};
    } else {
      return {valid: true, msg: null};
    }
  }

  var grid;
  var data = [
    {"title": "Revenue"},
    {"title": "Revenue growth %"},
    {"title": "Cost"},
    {"title": "Cost growth %"},
    {"title": "Account Receiveable Turnover"},
    {"title": "Account Payable Turnover"},
    {"title": "Inventory Turnover"},
    {"title": "Capital Expenditure"},
    {"title": "Research & Development"},
    {"title": "Discount rate for equity valuation"}
  ];
  
  var pl_data = [
    {"title": "Revenue"},
    {"title": "Cost"},
    {"title": "Gross Profit"},
    {"title": "MG&A"},
    {"title": "R&D"},
    {"title": "Profit before interest and tax"},
    {"title": "Tax"},
    {"title": "Net Income"}
  ];
  
  var bs_data = [
    {"title": "Cash"},
    {"title": "Working Capital"},
    {"title": "Fixed Asset"},
    {"title": "Total Assets"},
    {"title": "Retained Earnings"},
    {"title": "Paid-in Capital"},
    {"title": "Total liabilities and equity"}
  ];
  
  var cf_data = [
    {"title": "Net Income"},
    {"title": "Changes in Working Capital"},
    {"title": "Capital Expenditures"},
    {"title": "Free Cash Flow"},
    {"title": "Equity Value"}
  ];
  
  var columns = [
    {id: "title", name:"", field: "title", width: 200},
    {id: "y0", name: "now", field: "y0", width: 75, editor: Slick.Editors.Text, validator: requiredFieldValidator} ,
    {id: "y1", name: "year 1", field: "y1", width: 75, editor: Slick.Editors.Text, validator: requiredFieldValidator} ,
    {id: "y2", name: "year 2", field: "y2", width: 75, editor: Slick.Editors.Text, validator: requiredFieldValidator} ,
    {id: "y3", name: "year 3", field: "y3", width: 75, editor: Slick.Editors.Text, validator: requiredFieldValidator} ,
    {id: "y4", name: "year 4", field: "y4", width: 75, editor: Slick.Editors.Text, validator: requiredFieldValidator} ,
    {id: "y5", name: "year 5", field: "y5", width: 75, editor: Slick.Editors.Text, validator: requiredFieldValidator} ,
  ];
  
  var bs_columns = $.map(columns, function (obj) {
                        return $.extend(true, {}, obj);
                    });

  var pl_columns = $.map(columns, function (obj) {
                        return $.extend(true, {}, obj);
                    });

  var cf_columns = $.map(columns, function (obj) {
                       return $.extend(true, {}, obj);
                   });
  
  var options = {
    editable: true,
    enableAddRow: true,
    enableCellNavigation: true,
    asyncEditorLoading: false,
    autoEdit: true
  };
  
  var fs_options = {
    editable: false,
    enableAddRow: false,
    enableCellNavigation: true,
    asyncEditorLoading: false,
    autoEdit: false
  }

  $(function () {
    
    $("#add_row").click(function() {
      var dd = grid.getData();
      dd.splice(dd.length,0,{"input":""});
      grid.invalidateRow(data.length);
      grid.updateRowCount();
      grid.render();
      grid.scrollRowIntoView(dd.length-1)
    })
    
    $("#remove_row").click(function() {
      var dd = grid.getData();
      var current_row = grid.getActiveCell().row;
      dd.splice(current_row,1);
      var r = current_row;
      while (r<dd.length){
        grid.invalidateRow(r);
        r++;
      }
      grid.updateRowCount();
      grid.render();
      grid.scrollRowIntoView(current_row-1)
    })
    
    grid = new Slick.Grid("#myGrid", data, columns, options);
    
    pl_grid = new Slick.Grid("#plGrid", pl_data, pl_columns, fs_options);
                                                             
    bs_grid = new Slick.Grid("#bsGrid", bs_data, bs_columns, fs_options);
    
    grid.setSelectionModel(new Slick.CellSelectionModel());

    grid.onAddNewRow.subscribe(function (e, args) {
      var item = args.item;
      grid.invalidateRow(data.length);
      data.push(item);
      grid.updateRowCount();
      grid.render();
    });
  })
</script>
</body>
</html>
